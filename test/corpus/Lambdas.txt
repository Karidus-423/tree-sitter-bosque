=========================================
Simple Lambda
=========================================

function foo(f: fn(Int) -> Int): Int {
	return f(1i); 
}

function main(): Bool {
	return foo(fn(x: Int): Int => x + 1i); 
}

---

(source_file
  (function_definition
    (object_id
      (entity_id))
    (function_parameters
      (identifier)
      (lambda_type
        (entity_id)
        (entity_id)))
    (function_return_parameters
      (entity_id))
    (function_body
      (return_statement
        (function_call
          (identifier)
          (num_lit)))))
  (function_definition
    (object_id
      (entity_id))
    (function_parameters)
    (function_return_parameters
      (entity_id))
    (function_body
      (return_statement
        (function_call
          (identifier)
          (binary_expression
            (lambda_expression
              (identifier)
              (entity_id)
              (function_return_parameters
                (entity_id))
              (identifier))
            (num_lit)))))))

=========================================
Simple Lambda Infer Argument
=========================================

function foo(f: fn(Int) -> Int): Int {
	return f(1i); 
} 
function main(): Bool {
	return foo(fn(x): Int => { return x + 1i; }); 
}

---

(source_file
  (function_definition
    (object_id
      (entity_id))
    (function_parameters
      (identifier)
      (lambda_type
        (entity_id)
        (entity_id)))
    (function_return_parameters
      (entity_id))
    (function_body
      (return_statement
        (function_call
          (identifier)
          (num_lit)))))
  (function_definition
    (object_id
      (entity_id))
    (function_parameters)
    (function_return_parameters
      (entity_id))
    (function_body
      (return_statement
        (function_call
          (identifier)
          (lambda_expression
            (identifier)
            (function_return_parameters
              (entity_id))
            (function_body
              (return_statement
                (binary_expression
                  (identifier)
                  (num_lit))))))))))

=========================================
Simple Lambda with Return
=========================================

function foo(f: fn(Int) -> Int): Int {
	return f(1i); 
} 

function main(): Bool {
	return foo(fn(x: Int) => { return x + 1i; });
}

---

(source_file
  (function_definition
    (object_id
      (entity_id))
    (function_parameters
      (identifier)
      (lambda_type
        (entity_id)
        (entity_id)))
    (function_return_parameters
      (entity_id))
    (function_body
      (return_statement
        (function_call
          (identifier)
          (num_lit)))))
  (function_definition
    (object_id
      (entity_id))
    (function_parameters)
    (function_return_parameters
      (entity_id))
    (function_body
      (return_statement
        (function_call
          (identifier)
          (lambda_expression
            (identifier)
            (entity_id)
            (function_body
              (return_statement
                (binary_expression
                  (identifier)
                  (num_lit))))))))))

=========================================
Simple Lambda Infer Both
=========================================

function foo(f: fn(Int) -> Int): Int {
	return f(1i); 
} 

function main(): Bool {
	return foo(fn(x) => { return x + 1i; });
}

---

(source_file
  (function_definition
    (object_id
      (entity_id))
    (function_parameters
      (identifier)
      (lambda_type
        (entity_id)
        (entity_id)))
    (function_return_parameters
      (entity_id))
    (function_body
      (return_statement
        (function_call
          (identifier)
          (num_lit)))))
  (function_definition
    (object_id
      (entity_id))
    (function_parameters)
    (function_return_parameters
      (entity_id))
    (function_body
      (return_statement
        (function_call
          (identifier)
          (lambda_expression
            (identifier)
            (function_body
              (return_statement
                (binary_expression
                  (identifier)
                  (num_lit))))))))))

=========================================
Simple Lambda Capture
=========================================

function foo(f: fn(Int) -> Int): Int {
	return f(1i); 
} 

function main(): Bool {
	let y = 1i;
	return foo(fn(x) => { return x + y; }); 
}

---

(source_file
  (function_definition
    (object_id
      (entity_id))
    (function_parameters
      (identifier)
      (lambda_type
        (entity_id)
        (entity_id)))
    (function_return_parameters
      (entity_id))
    (function_body
      (return_statement
        (function_call
          (identifier)
          (num_lit)))))
  (function_definition
    (object_id
      (entity_id))
    (function_parameters)
    (function_return_parameters
      (entity_id))
    (function_body
      (variable_statement
        (variable_expression
          (identifier)
          (num_lit)))
      (return_statement
        (function_call
          (identifier)
          (lambda_expression
            (identifier)
            (function_body
              (return_statement
                (binary_expression
                  (identifier)
                  (identifier))))))))))

=========================================
Simple Lambda Reference Full
=========================================

entity Foo {
	field v: Int;
}

function foo(f: fn(ref Foo) -> Int): Int {
	let x = Foo{ 1i };
	return f(ref x);
} 

function main(): Bool {
	return foo(fn(ref x: Foo): Int => x.v); 
}

---

(source_file
  (entity
    (entity_id)
    (identifier)
    (entity_id))
  (function_definition
    (entity_id)
    (function_parameters
      (identifier)
      (lambda_type
        (entity_id)
        (entity_id)))
    (function_return_parameters
      (entity_id))
    (function_body
      (variable_statement
        (variable_expression
          (identifier)
          (entity_definition
            (entity_id)
            (num_lit))))
      (return_statement
        (function_call
          (identifier)
          (identifier)
          (identifier)))))
  (function_definition
    (entity_id)
    (function_parameters)
    (function_return_parameters
      (entity_id))
    (function_body
      (return_statement
        (function_call
          (identifier)
          (lambda_expression
            (identifier)
            (entity_id)
            (function_return_parameters
              (entity_id))
            (identifier)
            (identifier)))))))

=========================================
Simple Lambda Reference Infer
=========================================

entity Foo {
	field v: Int; 
} 

function foo(f: fn(ref Foo) -> Int): Int {
	let x = Foo{ 1i };
	return f(ref x);
}

function main(): Bool {
	return foo(fn(ref x) => { return x.v; });
}

---

(source_file
  (entity
    (entity_id)
    (identifier)
    (entity_id))
  (function_definition
    (entity_id)
    (function_parameters
      (identifier)
      (lambda_type
        (entity_id)
        (entity_id)))
    (function_return_parameters
      (entity_id))
    (function_body
      (variable_statement
        (variable_expression
          (identifier)
          (entity_definition
            (entity_id)
            (num_lit))))
      (return_statement
        (function_call
          (identifier)
          (identifier)
          (identifier)))))
  (function_definition
    (entity_id)
    (function_parameters)
    (function_return_parameters
      (entity_id))
    (function_body
      (return_statement
        (function_call
          (identifier)
          (lambda_expression
            (identifier)
            (function_body
              (return_statement
                (identifier)
                (identifier)))))))))
