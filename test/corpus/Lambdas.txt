=========================================
Simple Lambda
=========================================

function foo(f: fn(Int) -> Int): Int {
	return f(1i); 
}

function main(): Bool {
	return foo(fn(x: Int): Int => x + 1i); 
}

---

(source_file
  (function_definition
    (function_signature
      (identifier)
      (function_parameters
        (variable_expression
          (variable_signature
            (identifier)
            (lambda_type
              (identifier)
              (function_parameters
                (variable_expression
                  (variable_signature
                    (identifier))))
              (primitive_type)))))
      (function_return_parameters
        (primitive_type))
      (function_usage
        (object_body
          (return_statement
            (function_call
              (identifier)
              (function_call_parameters
                (num_whole))))))))
  (function_definition
    (function_signature
      (identifier)
      (function_parameters)
      (function_return_parameters
        (primitive_type))
      (function_usage
        (object_body
          (return_statement
            (function_call
              (identifier)
              (function_call_parameters
                (lambda_expression
                  (function_call
                    (identifier)
                    (function_call_parameters
                      (variable_expression
                        (variable_signature
                          (identifier)
                          (primitive_type)))))
                  (function_return_parameters
                    (primitive_type))
                  (binary_expression
                    (identifier)
                    (num_whole)))))))))))

=========================================
Simple Lambda Infer Argument
=========================================

function foo(f: fn(Int) -> Int): Int {
	return f(1i); 
} 
function main(): Bool {
	return foo(fn(x): Int => { return x + 1i; }); 
}

---

(source_file
  (function_definition
    (function_signature
      (identifier)
      (function_parameters
        (variable_expression
          (variable_signature
            (identifier)
            (lambda_type
              (identifier)
              (function_parameters
                (variable_expression
                  (variable_signature
                    (identifier))))
              (primitive_type)))))
      (function_return_parameters
        (primitive_type))
      (function_usage
        (object_body
          (return_statement
            (function_call
              (identifier)
              (function_call_parameters
                (num_whole))))))))
  (function_definition
    (function_signature
      (identifier)
      (function_parameters)
      (function_return_parameters
        (primitive_type))
      (function_usage
        (object_body
          (return_statement
            (function_call
              (identifier)
              (function_call_parameters
                (lambda_expression
                  (function_call
                    (identifier)
                    (function_call_parameters
                      (identifier)))
                  (function_return_parameters
                    (primitive_type))
                  (object_body
                    (return_statement
                      (binary_expression
                        (identifier)
                        (num_whole)))))))))))))

=========================================
Simple Lambda with Return
=========================================

function foo(f: fn(Int) -> Int): Int {
	return f(1i); 
} 

function main(): Bool {
	return foo(fn(x: Int) => { return x + 1i; });
}

---

(source_file
  (function_definition
    (function_signature
      (identifier)
      (function_parameters
        (variable_expression
          (variable_signature
            (identifier)
            (lambda_type
              (identifier)
              (function_parameters
                (variable_expression
                  (variable_signature
                    (identifier))))
              (primitive_type)))))
      (function_return_parameters
        (primitive_type))
      (function_usage
        (object_body
          (return_statement
            (function_call
              (identifier)
              (function_call_parameters
                (num_whole))))))))
  (function_definition
    (function_signature
      (identifier)
      (function_parameters)
      (function_return_parameters
        (primitive_type))
      (function_usage
        (object_body
          (return_statement
            (function_call
              (identifier)
              (function_call_parameters
                (lambda_expression
                  (function_call
                    (identifier)
                    (function_call_parameters
                      (variable_expression
                        (variable_signature
                          (identifier)
                          (primitive_type)))))
                  (object_body
                    (return_statement
                      (binary_expression
                        (identifier)
                        (num_whole)))))))))))))

=========================================
Simple Lambda Infer Both
=========================================

function foo(f: fn(Int) -> Int): Int {
	return f(1i); 
} 

function main(): Bool {
	return foo(fn(x) => { return x + 1i; });
}

---

(source_file
  (function_definition
    (function_signature
      (identifier)
      (function_parameters
        (variable_expression
          (variable_signature
            (identifier)
            (lambda_type
              (identifier)
              (function_parameters
                (variable_expression
                  (variable_signature
                    (identifier))))
              (primitive_type)))))
      (function_return_parameters
        (primitive_type))
      (function_usage
        (object_body
          (return_statement
            (function_call
              (identifier)
              (function_call_parameters
                (num_whole))))))))
  (function_definition
    (function_signature
      (identifier)
      (function_parameters)
      (function_return_parameters
        (primitive_type))
      (function_usage
        (object_body
          (return_statement
            (function_call
              (identifier)
              (function_call_parameters
                (lambda_expression
                  (function_call
                    (identifier)
                    (function_call_parameters
                      (identifier)))
                  (object_body
                    (return_statement
                      (binary_expression
                        (identifier)
                        (num_whole)))))))))))))

=========================================
Simple Lambda Capture
=========================================

function foo(f: fn(Int) -> Int): Int {
	return f(1i); 
} 

function main(): Bool {
	let y = 1i;
	return foo(fn(x) => { return x + y; }); 
}

---

(source_file
  (function_definition
    (function_signature
      (identifier)
      (function_parameters
        (variable_expression
          (variable_signature
            (identifier)
            (lambda_type
              (identifier)
              (function_parameters
                (variable_expression
                  (variable_signature
                    (identifier))))
              (primitive_type)))))
      (function_return_parameters
        (primitive_type))
      (function_usage
        (object_body
          (return_statement
            (function_call
              (identifier)
              (function_call_parameters
                (num_whole))))))))
  (function_definition
    (function_signature
      (identifier)
      (function_parameters)
      (function_return_parameters
        (primitive_type))
      (function_usage
        (object_body
          (variable_statement
            (variable_expression
              (variable_signature
                (identifier))
              (variable_assignment
                (num_whole))))
          (return_statement
            (function_call
              (identifier)
              (function_call_parameters
                (lambda_expression
                  (function_call
                    (identifier)
                    (function_call_parameters
                      (identifier)))
                  (object_body
                    (return_statement
                      (binary_expression
                        (identifier)
                        (identifier)))))))))))))

=========================================
Simple Lambda Reference Full
=========================================

entity Foo {
	field v: Int;
}

function foo(f: fn(ref Foo) -> Int): Int {
	let x = Foo{ 1i };
	return f(ref x);
} 

function main(): Bool {
	return foo(fn(ref x: Foo): Int => x.v); 
}

---

(source_file
  (entity_declaration
    (identifier)
    (object_body
      (field_statement
        (variable_expression
          (variable_signature
            (identifier)
            (primitive_type))))))
  (function_definition
    (function_signature
      (identifier)
      (function_parameters
        (variable_expression
          (variable_signature
            (identifier)
            (lambda_type
              (identifier)
              (function_parameters
                (variable_expression
                  (variable_signature
                    (identifier
                      (modifier)))))
              (primitive_type)))))
      (function_return_parameters
        (primitive_type))
      (function_usage
        (object_body
          (variable_statement
            (variable_expression
              (variable_signature
                (identifier))
              (variable_assignment
                (object_creation
                  (identifier)
                  (num_whole)))))
          (return_statement
            (function_call
              (identifier)
              (function_call_parameters
                (identifier
                  (modifier)))))))))
  (function_definition
    (function_signature
      (identifier)
      (function_parameters)
      (function_return_parameters
        (primitive_type))
      (function_usage
        (object_body
          (return_statement
            (function_call
              (identifier)
              (function_call_parameters
                (access_expression
                  (lambda_expression
                    (function_call
                      (identifier)
                      (function_call_parameters
                        (variable_expression
                          (variable_signature
                            (identifier
                              (modifier))
                            (identifier)))))
                    (function_return_parameters
                      (primitive_type))
                    (identifier))
                  (identifier))))))))))

=========================================
Simple Lambda Reference Infer
=========================================

entity Foo {
	field v: Int; 
} 

function foo(f: fn(ref Foo) -> Int): Int {
	let x = Foo{ 1i };
	return f(ref x);
}

function main(): Bool {
	return foo(fn(ref x) => { return x.v; });
}

---

(source_file
  (entity_declaration
    (identifier)
    (object_body
      (field_statement
        (variable_expression
          (variable_signature
            (identifier)
            (primitive_type))))))
  (function_definition
    (function_signature
      (identifier)
      (function_parameters
        (variable_expression
          (variable_signature
            (identifier)
            (lambda_type
              (identifier)
              (function_parameters
                (variable_expression
                  (variable_signature
                    (identifier
                      (modifier)))))
              (primitive_type)))))
      (function_return_parameters
        (primitive_type))
      (function_usage
        (object_body
          (variable_statement
            (variable_expression
              (variable_signature
                (identifier))
              (variable_assignment
                (object_creation
                  (identifier)
                  (num_whole)))))
          (return_statement
            (function_call
              (identifier)
              (function_call_parameters
                (identifier
                  (modifier)))))))))
  (function_definition
    (function_signature
      (identifier)
      (function_parameters)
      (function_return_parameters
        (primitive_type))
      (function_usage
        (object_body
          (return_statement
            (function_call
              (identifier)
              (function_call_parameters
                (lambda_expression
                  (function_call
                    (identifier)
                    (function_call_parameters
                      (identifier
                        (modifier))))
                  (object_body
                    (return_statement
                      (access_expression
                        (identifier)
                        (identifier)))))))))))))

=========================================
Parenthesized Lambda
=========================================

(fn(b: Body): Float => b.kineticEnergy())

---

(source_file
  (parenthesized_expression
    (access_expression
      (lambda_expression
        (function_call
          (identifier)
          (function_call_parameters
            (variable_expression
              (variable_signature
                (identifier)
                (identifier)))))
        (function_return_parameters
          (primitive_type))
        (identifier))
      (function_call
        (identifier)
        (function_call_parameters)))))
